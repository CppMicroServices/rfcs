<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="331px" preserveAspectRatio="none" style="width:787px;height:331px;background:#FFFFFF;" version="1.1" viewBox="0 0 787 331" width="787px" zoomAndPan="magnify"><defs><filter height="300%" id="ftavpzdz3o0rb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[0ba5ee7700168656dc1b457c6fe9fdac]
entity Client--><ellipse cx="36.43" cy="14" fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" rx="8" ry="8" style="stroke:#A80036;stroke-width:1.5;"/><path d="M36.43,22 L36.43,49 M23.43,30 L49.43,30 M36.43,49 L23.43,64 M36.43,49 L49.43,64 " fill="none" filter="url(#ftavpzdz3o0rb)" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="18.43" y="84.0332">Client</text><!--MD5=[12e922f5689a4b39af25c0eb21e26788]
entity BT--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="113" x="131.93" y="27"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="141.93" y="51.5332">BundleTracker</text><!--MD5=[ab76d8afd5a3119a5a6b337bb0f5ab81]
entity BTP--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="157" x="618.93" y="165.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="628.93" y="190.0332">BundleTrackerPrivate</text><!--MD5=[92e1b8d0a4b2a37ccd7fcd96c5dfe02c]
entity TB--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="116" x="47.43" y="165.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="57.43" y="190.0332">TrackedBundle</text><!--MD5=[78be0622f0aca91e0dae736fd52d3ffb]
entity BC--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="112" x="373.43" y="27"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="383.43" y="51.5332">BundleContext</text><!--MD5=[bf47ed657672796465dc76c4ef1ad49d]
entity BAT--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="168" x="21.43" y="281.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="31.43" y="306.0332">BundleAbstractTracked</text><!--MD5=[6815a7c98912f1a3feb5ab6a43f68320]
entity BTC--><rect fill="#FEFECE" filter="url(#ftavpzdz3o0rb)" height="37.6094" style="stroke:#000000;stroke-width:1.5;" width="183" x="400.93" y="165.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163" x="410.93" y="190.0332">BundleTrackerCustomizer</text><!--MD5=[6d60a2609ab0a1c9580d799ef3a81eb5]
link Client to BT--><path d="M54.46,46 C72.3,46 100.63,46 126.66,46 " fill="none" id="Client-to-BT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="131.83,46,122.83,42,126.83,46,122.83,50,131.83,46" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="72.68" y="39.4951">Close()</text><!--MD5=[bcde373f95adde5abceec89c4cd4ed37]
reverse link BT to BTP--><path d="M250.41,63.62 C346.51,89.39 530.72,138.79 630.02,165.42 " fill="none" id="BT-backto-BTP" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="245.33,62.26,252.9806,68.4622,250.1581,63.5599,255.0604,60.7373,245.33,62.26" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="518.43" y="131.9951">Get listener and TrackedBundle</text><!--MD5=[52d2cc04104b8293c7f426ab2a9511b3]
reverse link BT to TB--><path d="M180.6,70.17 C173.8,88.66 162.94,114.81 149.43,135.5 C142.5,146.1 133.22,156.61 124.96,165.09 " fill="none" id="BT-backto-TB" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="182.41,65.17,175.5873,72.2728,180.7093,69.8719,183.1103,74.9939,182.41,65.17" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="160.43" y="131.9951">Wait for customizers</text><!--MD5=[a2531f00426be942fe55c529d6d7a04e]
link BT to TB--><path d="M153.8,65.22 C134.83,77.26 113.08,94.99 102.43,117.5 C96.19,130.68 96.88,147.05 99.17,160.18 " fill="none" id="BT-to-TB" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="100.15,165.23,102.3774,155.6363,99.2052,160.3201,94.5215,157.1479,100.15,165.23" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="103.43" y="131.9951">Close()</text><!--MD5=[64984962add78f2f1b6afe3f4f5c04c7]
link BT to BC--><path d="M244.93,46 C283.61,46 334.67,46 373.28,46 " fill="none" id="BT-BC" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="263.18" y="39.4951">Remove listener</text><!--MD5=[cacacb7581613e5b42688c4f9585ce2a]
link TB to BAT--><path d="M51.11,203.62 C37.79,210.77 25.15,220.48 17.43,233.5 C6,252.74 23.48,268.2 45.79,279.3 " fill="none" id="TB-to-BAT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="50.31,281.47,43.9141,273.9805,45.7986,279.3142,40.4649,281.1987,50.31,281.47" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="18.43" y="247.9951">Untrack() on bundles</text><!--MD5=[fa316361f97ac789e93be1e306990b42]
link BAT to TB--><path d="M127.09,281.15 C135.09,272.99 143.22,262.69 147.43,251.5 C153.36,235.71 143.66,219.72 132.09,207.43 " fill="none" id="BAT-to-TB" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="128.46,203.73,131.9398,212.9436,131.974,207.2869,137.6308,207.3212,128.46,203.73" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="150.43" y="247.9951">CustomizerRemoved() on bundles</text><!--MD5=[94eec27b364eedefe4260f9931564d8a]
link TB to BTC--><path d="M163.78,184.5 C225.13,184.5 322.67,184.5 395.58,184.5 " fill="none" id="TB-to-BTC" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="400.79,184.5,391.79,180.5,395.79,184.5,391.79,188.5,400.79,184.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="181.68" y="177.9951">Call user-defined RemovedBundle()</text><!--MD5=[97ba0e5b513ac7573580aadcd1470521]
@startuml close_diagram
:Client: as Client

rectangle "BundleTracker" as BT
rectangle "BundleTrackerPrivate" as BTP
rectangle "TrackedBundle" as TB
rectangle "BundleContext" as BC
rectangle "BundleAbstractTracked" as BAT
rectangle "BundleTrackerCustomizer" as BTC

Client -> BT : Close()
BT <-d- BTP : Get listener and TrackedBundle
BT <-d- TB : Wait for customizers
BT -> TB : Close()
BT - BC : Remove listener

TB -d-> BAT : Untrack() on bundles
BAT -> TB : CustomizerRemoved() on bundles
TB -> BTC : Call user-defined RemovedBundle()

@enduml

PlantUML version 1.2022.0(Tue Jan 11 11:16:42 EST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>