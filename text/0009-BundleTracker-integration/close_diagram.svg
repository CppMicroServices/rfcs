<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="321px" preserveAspectRatio="none" style="width:804px;height:321px;background:#FFFFFF;" version="1.1" viewBox="0 0 804 321" width="804px" zoomAndPan="magnify"><defs/><g><!--MD5=[0ba5ee7700168656dc1b457c6fe9fdac]
entity Client--><g id="elem_Client"><ellipse cx="44.08" cy="14" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M44.08,22 L44.08,49 M31.08,30 L57.08,30 M44.08,49 L31.08,64 M44.08,49 L57.08,64 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="26.08" y="80.0332">Client</text></g><!--MD5=[12e922f5689a4b39af25c0eb21e26788]
entity BT--><g id="elem_BT"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="154.58" y="25.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="164.58" y="50.0332">BundleTracker</text></g><!--MD5=[ab76d8afd5a3119a5a6b337bb0f5ab81]
entity BTP--><g id="elem_BTP"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="157" x="641.58" y="161.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="651.58" y="186.0332">BundleTrackerPrivate</text></g><!--MD5=[92e1b8d0a4b2a37ccd7fcd96c5dfe02c]
entity TB--><g id="elem_TB"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116" x="55.08" y="161.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="65.08" y="186.0332">TrackedBundle</text></g><!--MD5=[78be0622f0aca91e0dae736fd52d3ffb]
entity BC--><g id="elem_BC"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="411.08" y="25.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="421.08" y="50.0332">BundleContext</text></g><!--MD5=[bf47ed657672796465dc76c4ef1ad49d]
entity BAT--><g id="elem_BAT"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="29.08" y="277.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="39.08" y="302.0332">BundleAbstractTracked</text></g><!--MD5=[6815a7c98912f1a3feb5ab6a43f68320]
entity BTC--><g id="elem_BTC"><rect fill="#F1F1F1" height="37.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183" x="423.58" y="161.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163" x="433.58" y="186.0332">BundleTrackerCustomizer</text></g><!--MD5=[6d60a2609ab0a1c9580d799ef3a81eb5]
link Client to BT--><g id="link_Client_BT"><path d="M62.27,44.5 C83.05,44.5 118.17,44.5 149.07,44.5 " fill="none" id="Client-to-BT" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="154.39,44.5,145.39,40.5,149.39,44.5,145.39,48.5,154.39,44.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="80.33" y="37.9951">1: Close()</text></g><!--MD5=[bcde373f95adde5abceec89c4cd4ed37]
reverse link BT to BTP--><g id="link_BT_BTP"><path d="M273.04,61.81 C368.73,87 551.83,135.21 651.43,161.43 " fill="none" id="BT-backto-BTP" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="267.99,60.48,275.6793,66.6343,272.8261,61.7497,277.7107,58.8965,267.99,60.48" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="527.08" y="127.9951">2: Get listener and TrackedBundle</text></g><!--MD5=[52d2cc04104b8293c7f426ab2a9511b3]
reverse link BT to TB--><g id="link_BT_TB"><path d="M203.91,68.55 C197.49,86.83 186.81,112.39 172.08,131.5 C163.29,142.9 151.29,153.29 140.41,161.47 " fill="none" id="BT-backto-TB" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="205.61,63.6,198.9168,70.825,203.9946,68.3319,206.4878,73.4097,205.61,63.6" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="185.08" y="127.9951">3: Wait for customizers</text></g><!--MD5=[a2531f00426be942fe55c529d6d7a04e]
link BT to TB--><g id="link_BT_TB"><path d="M166.2,63.59 C145.13,74.63 122.05,91.01 110.08,113.5 C103.18,126.46 103.93,142.96 106.41,156.22 " fill="none" id="BT-to-TB" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="107.47,161.32,109.5358,151.6902,106.4428,156.4266,101.7064,153.3337,107.47,161.32" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="111.08" y="127.9951">4: Close()</text></g><!--MD5=[64984962add78f2f1b6afe3f4f5c04c7]
link BT to BC--><g id="link_BT_BC"><path d="M267.89,44.5 C310.47,44.5 368.44,44.5 410.86,44.5 " fill="none" id="BT-BC" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="285.83" y="37.9951">5: Remove listener</text></g><!--MD5=[cacacb7581613e5b42688c4f9585ce2a]
link TB to BAT--><g id="link_TB_BAT"><path d="M55.05,198.49 C40.49,205.65 26.6,215.65 18.08,229.5 C6,249.14 23.87,264.45 47.26,275.35 " fill="none" id="TB-to-BAT" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="52,277.47,45.396,270.1633,47.4298,275.442,42.1511,277.4757,52,277.47" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="19.08" y="243.9951">6: Untrack() on bundles</text></g><!--MD5=[fa316361f97ac789e93be1e306990b42]
link BAT to TB--><g id="link_BAT_TB"><path d="M140.79,277.44 C156.15,264.99 170.74,247.48 163.08,229.5 C158.78,219.42 151.21,210.43 143.24,203.04 " fill="none" id="BAT-to-TB" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="139.31,199.54,143.3601,208.5176,143.0399,202.8698,148.6877,202.5497,139.31,199.54" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="167.08" y="243.9951">7: CustomizerRemoved() on bundles</text></g><!--MD5=[94eec27b364eedefe4260f9931564d8a]
link TB to BTC--><g id="link_TB_BTC"><path d="M171.1,180.5 C235.68,180.5 341.07,180.5 418.2,180.5 " fill="none" id="TB-to-BTC" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="423.24,180.5,414.24,176.5,418.24,180.5,414.24,184.5,423.24,180.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="189.33" y="173.9951">8: Call user-defined RemovedBundle()</text></g><!--MD5=[bc8ca246040ba763100d65f0bee25089]
@startuml close_diagram
:Client: as Client

rectangle "BundleTracker" as BT
rectangle "BundleTrackerPrivate" as BTP
rectangle "TrackedBundle" as TB
rectangle "BundleContext" as BC
rectangle "BundleAbstractTracked" as BAT
rectangle "BundleTrackerCustomizer" as BTC

Client -> BT : 1: Close()
BT <-d- BTP : 2: Get listener and TrackedBundle
BT <-d- TB : 3: Wait for customizers
BT -> TB : 4: Close()
BT - BC : 5: Remove listener

TB -d-> BAT : 6: Untrack() on bundles
BAT -> TB : 7: CustomizerRemoved() on bundles
TB -> BTC : 8: Call user-defined RemovedBundle()

@enduml

PlantUML version 1.2022.5(Sat Apr 30 06:55:52 EDT 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>